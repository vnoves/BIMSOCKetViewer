<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>BIMSocket</title>
    <style>
        #body {
            height: 99vh;
            margin: 0;
        }

        object {
            height: 100%;
            width: 100%;
        }

        h1 {
            text-align: center;
            margin-top: 10rem;
        }

        .example {
            padding: 10px;
            border: 1px solid #ccc;
        }

        #drag-drop {
            margin-top: 3rem;
        }

        #drop_zone {
            border: 2px dashed #bbb;
            -moz-border-radius: 5px;
            -webkit-border-radius: 5px;
            border-radius: 5px;
            padding: 25px;
            text-align: center;
            font: 20pt bold 'Vollkorn';
            color: #bbb;
        }

        .container {
            width: 40rem;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
</head>
<body id="body">
    <h1>BIMSocket</h1>

    <div class="container">
        <div id="drag-drop" class="example">
            <div id="drop_zone">Drop file here</div>
            <output id="file_list2"></output>
        </div>
                            
        <output id="list"></output>
            <br>
            <br>
            <br>

        <div class="intro-text">
            <input class="" type="file" id="file-input" accept="image/*" capture="" name="files[]" multiple="">
        </div>
    </div>
    
</body>

<script>
    // Determinates what page render
    function load_home() {
        firebaseConfigJSON = localStorage.getItem('firebaseConfig');
        if (firebaseConfigJSON) {
            document.getElementById("body").innerHTML='<object type="text/html" data="ViewerBIMSocket.html" ></object>';
        }
    }
    load_home();

    // Prevent Default loader for files
    $( '#example' ).bind( 'dragover',function(event) {
        event.stopPropagation();    
        event.preventDefault(); 
    });
    $( '#example' ).bind( 'drop',function(event) {
     event.stopPropagation();   
      event.preventDefault();
    })

    // Drag and drop file selection
    function handleFileSelect(evt) {
        evt.stopPropagation();
        evt.preventDefault();

        var files = evt.dataTransfer.files; // FileList object.

        var reader = new FileReader();
            reader.onloadend = function(e) {
            var result = JSON.parse(this.result);
            localStorage.setItem('firebaseConfig', this.result);
        };
        reader.readAsText(files[0]);

        // files is a FileList of File objects. List some properties.
        var output = [];
        for (var i = 0, f; f = files[i]; i++) {
            output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
                    f.size, ' bytes, last modified: ',
                    f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a',
                    '</li>');
        }
        document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';

        document.getElementById("body").innerHTML='<object type="text/html" data="ViewerBIMSocket.html" ></object>';
    }

    function handleDragOver(evt) {
        evt.stopPropagation();
        evt.preventDefault();
        evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
    }

    // Setup the dnd listeners.
    var dropZone = document.getElementById('drop_zone');
    dropZone.addEventListener('dragover', handleDragOver, false);
    dropZone.addEventListener('drop', handleFileSelect, false);
</script>
</html>